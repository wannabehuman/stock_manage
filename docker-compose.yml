


version: "3.8"
services:
  backend:
    build:
      dockerfile: dockerfile
      context: ./backend/
    volumes:
      - ./backend/nestjs/:/backend/nestjs/
      - /backend/nestjs/node_modules
    command: npm run start:dev
    environment: 
      - CHOKIDAR_USEPOLLING=true
    expose:
      - 3000 # 내부적으로 NestJS가 사용하는 포트
    ports:
      - 3000:3000 # NestJS가 직접 연결될 경우 사용 (디버깅 시 편리)
    networks:
      - app-network
  frontend:
    build:
      dockerfile: dockerfile
      context: ./frontend
    volumes:
      - ./frontend/react-app:/frontend/react-app
      - /frontend/react-app/node_modules
    command: npm run dev -- --host 0.0.0.0
    environment: 
      - CHOKIDAR_USEPOLLING=true
    expose:
      - 5173 # 내부적으로 React/Vite가 사용하는 포트 
    ports:
      - 5173:5173 # React 앱에 직접 연결될 경우 사용 (개발 시 편리)
    networks:
      - app-network
    depends_on:
      - backend
  nginx:
    build:
      dockerfile: dockerfile
      context: ./nginx
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro # Nginx 설정 파일
    ports:
      - 80:80 # Nginx가 외부에서 80포트로 수신
    depends_on:
      - backend
      # - frontend
    networks:
      - app-network

networks:
  app-network:
    driver: bridge